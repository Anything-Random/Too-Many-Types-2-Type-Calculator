<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Type Calculator</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #111;
      color: #eee;
    }

    header {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      background: #1c1c1c;
    }

    header button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      background: #333;
      color: #eee;
      border: none;
      cursor: pointer;
    }

    header button.active {
      background: #555;
      font-weight: bold;
    }

    .description {
      max-width: 900px;
      margin: 1.5rem auto 0;
      padding: 0 1rem;
      text-align: center;
      line-height: 1.5;
      color: #ccc;
    }

    main {
      display: flex;
      justify-content: center;
      align-items: center;
      height: calc(100vh - 220px);
    }

    .calculator {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 3rem;
      align-items: start;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .column h2 {
      margin: 0 0 0.5rem;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: #ddd;
    }

    select {
      padding: 0.5rem;
      font-size: 1rem;
      background: #222;
      color: #eee;
      border: 1px solid #444;
    }

    .result {
      font-size: 4rem;
      font-weight: bold;
      min-width: 6ch;
      text-align: center;
      padding-top: 2.2rem;
    }
  </style>
</head>
<body>

<header>
  <button class="active">Move Effectiveness</button>
  <button>Team Coverage</button>
  <button>Defensive Match-Up</button>
</header>

<div class="description">
  <p>
    This page contains some handy tools for the ROM hack Too Many Types 2,
    avaible at <a href=https://www.hackdex.app/hack/too-many-types-2>hackdex</a>.
  </p>
  <p>
    The <strong>Move Effectiveness Calculator</strong> shows the type
    effectiveness of a damaging move against a pokemon of the chosen
    types.Select up to four types on each side to see how they interact.
  </p>
  <p>
    Disclaimer: I have no idea how the multi-type attacks work in
    this game, so I gave it my best guess. I just calculated the
    type effectiveness of each attack type individually against a
    defending pokemon and then multiplied them together. I allowed
    defending pokemon to have up to 4 types to account for
    type-adding moves. I wasn't sure how many types an attack can
    have so I just made it symmetrical. I assumed that the Uno type
    works by taking the reciprocal of the usual type effectiveness
    (i.e., 0.5x becomes 1/0.5 = 2x) and immunity just becomes 2x.
    Lastly, I wasn't sure how the Every type works, it seems like
    it has some special functionality, but I just used the numbers
    presented in the type chart andd I will update it when any new
    info becomes available.
    If anyone has any corrections on how this works they can message
    me in the Too Many Productions discord @anything_random.
  </p>
</div>

<main>
  <div class="calculator">
    <!-- Attack types -->
    <div class="column" id="attack-column">
      <h2>Attack Type(s)</h2>
      <select></select>
      <select></select>
      <select></select>
      <select></select>
    </div>

    <!-- Result -->
    <div class="result" id="result">1×</div>

    <!-- Defence types -->
    <div class="column" id="defence-column">
      <h2>Defence Type(s)</h2>
      <select></select>
      <select></select>
      <select></select>
      <select></select>
    </div>
  </div>
</main>

<script>
  const TYPES = [
    'Normal', 'Fighting', 'Flying', 'Poison', 'Ground', 'Rock', 'Bug',
    'Ghost', 'Steel', 'Mystery/Typeless', 'Fire', 'Water', 'Grass',
    'Electric', 'Psychic', 'Ice', 'Dragon', 'Dark', 'Fairy', 'Stellar',
    'Ancient', 'Anime', 'Baby', 'Ball', 'Bean', 'Bird', 'Brat', 'Boring',
    'Cat', 'Crab', 'Dance', 'Deez Nuts', 'Emerald', 'Family', 'Fast',
    'Firefight', 'Florida', 'Fluffy', 'Food', 'Freak', 'Friend', 'Frog',
    'Furry', 'Future', 'Gamer', 'Gaslight', 'Gatekeep', 'Gender',
    'Girlboss', 'Goblin', 'Goku', 'Gun', 'Guys', 'Hater', 'Holy', 'Kaiju',
    'Little', 'Magic', 'Mario', 'Monke', 'Ninja', 'Pikachu', 'Rat',
    'Reddit', 'Sans', 'Sharp', 'Silly', 'Song', 'Space', 'Stinky', 'Sus',
    'Thing', 'Ugly', 'Unalive', 'Uno', 'Vgc', 'Vibes', 'Wealth', 'Yapper',
    'Every'
  ];

  function populateSelect(select) {
    const empty = document.createElement("option");
    empty.value = "";
    empty.textContent = "—";
    select.appendChild(empty);

    for (const type of TYPES) {
      const option = document.createElement("option");
      option.value = type;
      option.textContent = type;
      select.appendChild(option);
    }

    select.addEventListener("change", calculate);
  }

  document.querySelectorAll("select").forEach(populateSelect);

  async function calculate() {
    const attackers = [...document.querySelectorAll("#attack-column select")]
      .map(s => s.value)
      .filter(Boolean);

    const defenders = [...document.querySelectorAll("#defence-column select")]
      .map(s => s.value)
      .filter(Boolean);

    if (attackers.length === 0 || defenders.length === 0) {
      document.getElementById("result").textContent = "—";
      return;
    }

    try {
      const response = await fetch("/attack", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          attackers: attackers,
          defenders: defenders
        })
      });

      const data = await response.json();
      document.getElementById("result").textContent = `${data.multiplier}×`;
    } catch {
      document.getElementById("result").textContent = "ERR";
    }
  }
</script>

</body>
</html>
